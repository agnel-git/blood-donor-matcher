
 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DonorMatch ‚Äî Save Lives Near You</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --crimson: #C0152A;
      --crimson-dark: #8B0E1E;
      --crimson-light: #E8203A;
      --bg: #0A0A0F;
      --bg2: #111118;
      --bg3: #1A1A24;
      --card: #14141C;
      --border: rgba(255,255,255,0.07);
      --text: #F0EEF6;
      --muted: #7A7890;
      --accent: #FF6B6B;
      --green: #22C55E;
      --yellow: #F59E0B;
      --blue: #3B82F6;
      --font-display: 'Playfair Display', Georgia, serif;
      --font-body: 'DM Sans', sans-serif;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* ‚îÄ‚îÄ SCROLLBAR ‚îÄ‚îÄ */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--crimson-dark); border-radius: 3px; }

    /* ‚îÄ‚îÄ NAV ‚îÄ‚îÄ */
    nav {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 2rem; height: 64px;
      background: rgba(10,10,15,0.9);
      backdrop-filter: blur(20px);
      border-bottom: 1px solid var(--border);
    }
    .nav-brand {
      display: flex; align-items: center; gap: 10px;
      font-family: var(--font-display); font-size: 1.4rem; font-weight: 700;
      color: var(--text); text-decoration: none;
      cursor: pointer;
    }
    .nav-brand .drop { color: var(--crimson); }
    .nav-actions { display: flex; gap: 12px; align-items: center; }
    .btn {
      display: inline-flex; align-items: center; gap: 6px;
      padding: 8px 18px; border-radius: 8px; font-size: 0.875rem;
      font-family: var(--font-body); font-weight: 500;
      cursor: pointer; transition: all 0.2s; border: none; text-decoration: none;
    }
    .btn-ghost { background: transparent; color: var(--muted); border: 1px solid var(--border); }
    .btn-ghost:hover { color: var(--text); border-color: rgba(255,255,255,0.2); }
    .btn-primary { background: var(--crimson); color: white; }
    .btn-primary:hover { background: var(--crimson-light); transform: translateY(-1px); box-shadow: 0 4px 20px rgba(192,21,42,0.4); }
    .btn-outline { background: transparent; color: var(--crimson); border: 1px solid var(--crimson); }
    .btn-outline:hover { background: rgba(192,21,42,0.1); }
    .btn-green { background: var(--green); color: #000; }
    .btn-green:hover { opacity: 0.9; }
    .btn-sm { padding: 5px 12px; font-size: 0.8rem; }
    .btn-lg { padding: 12px 28px; font-size: 1rem; }

    /* ‚îÄ‚îÄ PAGES ‚îÄ‚îÄ */
    .page { display: none; min-height: 100vh; padding-top: 64px; }
    .page.active { display: block; }

    /* ‚îÄ‚îÄ HERO ‚îÄ‚îÄ */
    #page-home {
      background: radial-gradient(ellipse 80% 60% at 50% -10%, rgba(192,21,42,0.3) 0%, transparent 60%);
    }
    .hero {
      display: flex; flex-direction: column; align-items: center;
      justify-content: center; text-align: center;
      padding: 5rem 2rem 4rem;
      min-height: calc(100vh - 64px);
    }
    .hero-eyebrow {
      display: inline-flex; align-items: center; gap: 8px;
      background: rgba(192,21,42,0.12); border: 1px solid rgba(192,21,42,0.3);
      padding: 6px 16px; border-radius: 100px;
      font-size: 0.8rem; font-weight: 500; color: var(--accent);
      margin-bottom: 2rem; letter-spacing: 0.05em;
    }
    .hero h1 {
      font-family: var(--font-display); font-size: clamp(2.5rem, 7vw, 5.5rem);
      font-weight: 900; line-height: 1.05; max-width: 800px;
      margin-bottom: 1.5rem;
    }
    .hero h1 em { color: var(--crimson); font-style: normal; }
    .hero p {
      font-size: 1.15rem; color: var(--muted); max-width: 520px;
      line-height: 1.7; margin-bottom: 2.5rem;
    }
    .hero-btns { display: flex; gap: 14px; flex-wrap: wrap; justify-content: center; }
    .hero-stats {
      display: flex; gap: 3rem; margin-top: 4rem; flex-wrap: wrap; justify-content: center;
    }
    .stat { text-align: center; }
    .stat-num { font-family: var(--font-display); font-size: 2.5rem; font-weight: 700; color: var(--crimson); }
    .stat-label { font-size: 0.8rem; color: var(--muted); margin-top: 2px; }

    /* ‚îÄ‚îÄ AUTH FORMS ‚îÄ‚îÄ */
    .auth-container {
      display: flex; justify-content: center; align-items: flex-start;
      padding: 3rem 1rem; min-height: calc(100vh - 64px);
    }
    .auth-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 16px; padding: 2.5rem; width: 100%; max-width: 480px;
      margin-top: 1rem;
    }
    .auth-card h2 {
      font-family: var(--font-display); font-size: 1.8rem; margin-bottom: 0.4rem;
    }
    .auth-card p { color: var(--muted); font-size: 0.9rem; margin-bottom: 2rem; }

    .form-group { margin-bottom: 1.2rem; }
    .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
    label { display: block; font-size: 0.8rem; font-weight: 500; color: var(--muted); margin-bottom: 6px; letter-spacing: 0.04em; }
    input, select, textarea {
      width: 100%; padding: 10px 14px; background: var(--bg2);
      border: 1px solid var(--border); border-radius: 8px;
      color: var(--text); font-family: var(--font-body); font-size: 0.9rem;
      transition: border-color 0.2s;
      -webkit-appearance: none;
    }
    input:focus, select:focus, textarea:focus {
      outline: none; border-color: var(--crimson);
    }
    select option { background: var(--bg2); }
    .role-tabs {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 8px; margin-bottom: 1.5rem;
    }
    .role-tab {
      padding: 10px; text-align: center; border-radius: 8px;
      border: 1px solid var(--border); cursor: pointer;
      font-size: 0.875rem; font-weight: 500; transition: all 0.2s;
      color: var(--muted);
    }
    .role-tab.active { border-color: var(--crimson); background: rgba(192,21,42,0.12); color: var(--text); }
    .auth-switch { text-align: center; margin-top: 1.5rem; font-size: 0.875rem; color: var(--muted); }
    .auth-switch a { color: var(--crimson); cursor: pointer; }
    .error-msg { background: rgba(192,21,42,0.1); border: 1px solid rgba(192,21,42,0.3); color: var(--accent); padding: 10px 14px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 1rem; display: none; }
    .success-msg { background: rgba(34,197,94,0.1); border: 1px solid rgba(34,197,94,0.3); color: var(--green); padding: 10px 14px; border-radius: 8px; font-size: 0.85rem; margin-bottom: 1rem; display: none; }
    .location-btn { width: 100%; margin-top: 6px; justify-content: center; background: var(--bg3); border: 1px dashed var(--border); color: var(--muted); }
    .location-btn:hover { border-color: var(--crimson); color: var(--text); }

    /* ‚îÄ‚îÄ DASHBOARD ‚îÄ‚îÄ */
    .dashboard {
      max-width: 1200px; margin: 0 auto;
      padding: 2rem 1.5rem;
    }
    .dashboard-header {
      display: flex; justify-content: space-between; align-items: center;
      margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;
    }
    .dashboard-header h2 { font-family: var(--font-display); font-size: 1.8rem; }
    .dashboard-header p { color: var(--muted); font-size: 0.9rem; margin-top: 2px; }

    .stats-grid {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem; margin-bottom: 2rem;
    }
    .stat-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 12px; padding: 1.4rem;
    }
    .stat-card .stat-label { font-size: 0.75rem; color: var(--muted); margin-bottom: 8px; letter-spacing: 0.05em; }
    .stat-card .stat-value { font-family: var(--font-display); font-size: 2rem; font-weight: 700; }
    .stat-card.red .stat-value { color: var(--crimson); }
    .stat-card.green .stat-value { color: var(--green); }
    .stat-card.blue .stat-value { color: var(--blue); }
    .stat-card.yellow .stat-value { color: var(--yellow); }

    /* availability toggle */
    .avail-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 12px; padding: 1.5rem;
      display: flex; align-items: center; justify-content: space-between;
      margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;
    }
    .avail-status {
      display: flex; align-items: center; gap: 12px;
    }
    .status-dot {
      width: 14px; height: 14px; border-radius: 50%;
      animation: pulse 2s infinite;
    }
    .status-dot.green { background: var(--green); box-shadow: 0 0 12px var(--green); }
    .status-dot.red { background: var(--crimson); box-shadow: 0 0 12px var(--crimson); animation: none; }
    @keyframes pulse {
      0%,100% { opacity: 1; } 50% { opacity: 0.4; }
    }
    .avail-text strong { font-size: 1.1rem; display: block; }
    .avail-text span { font-size: 0.8rem; color: var(--muted); }

    /* donor/search cards */
    .section-title {
      font-family: var(--font-display); font-size: 1.2rem;
      margin-bottom: 1rem; display: flex; align-items: center; gap: 10px;
    }
    .filters {
      display: flex; gap: 10px; margin-bottom: 1.5rem; flex-wrap: wrap;
    }
    .filters select, .filters input { flex: 1; min-width: 140px; max-width: 200px; }
    .donors-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
    }
    .donor-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 12px; padding: 1.2rem; transition: border-color 0.2s;
    }
    .donor-card:hover { border-color: rgba(192,21,42,0.4); }
    .donor-card-top { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.8rem; }
    .blood-badge {
      background: var(--crimson); color: white; font-weight: 700;
      font-family: var(--font-display); font-size: 1.1rem;
      width: 48px; height: 48px; border-radius: 10px;
      display: flex; align-items: center; justify-content: center;
    }
    .avail-badge {
      font-size: 0.7rem; font-weight: 600; padding: 3px 8px; border-radius: 100px;
    }
    .avail-badge.available { background: rgba(34,197,94,0.15); color: var(--green); }
    .avail-badge.unavailable { background: rgba(192,21,42,0.15); color: var(--accent); }
    .donor-name { font-weight: 600; font-size: 1rem; margin-bottom: 2px; }
    .donor-meta { font-size: 0.8rem; color: var(--muted); }
    .donor-meta span { display: inline-flex; align-items: center; gap: 4px; margin-right: 12px; }
    .donor-card .btn { margin-top: 1rem; width: 100%; justify-content: center; }

    /* Blood type chart */
    .blood-chart {
      display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
      margin-bottom: 2rem;
    }
    .blood-type-item {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 12px; text-align: center;
    }
    .blood-type-item .type { font-family: var(--font-display); font-size: 1.3rem; font-weight: 700; color: var(--crimson); }
    .blood-type-item .count { font-size: 0.8rem; color: var(--muted); margin-top: 2px; }

    /* requests */
    .requests-list { display: flex; flex-direction: column; gap: 10px; }
    .request-item {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 1rem;
      display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 8px;
    }
    .request-info strong { display: block; font-size: 0.95rem; }
    .request-info span { font-size: 0.8rem; color: var(--muted); }
    .urgency-badge { font-size: 0.7rem; font-weight: 700; padding: 3px 8px; border-radius: 100px; letter-spacing: 0.04em; }
    .urgency-badge.critical { background: rgba(192,21,42,0.2); color: var(--accent); }
    .urgency-badge.high { background: rgba(245,158,11,0.2); color: var(--yellow); }
    .urgency-badge.medium { background: rgba(59,130,246,0.2); color: var(--blue); }
    .urgency-badge.low { background: rgba(34,197,94,0.2); color: var(--green); }
    .fulfilled-badge { font-size: 0.7rem; background: rgba(34,197,94,0.1); color: var(--green); padding: 3px 8px; border-radius: 100px; }

    /* request form */
    .request-form-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem;
    }
    .request-form-card h3 { font-family: var(--font-display); font-size: 1.1rem; margin-bottom: 1.2rem; }
    .request-form-row { display: grid; grid-template-columns: 1fr 1fr 1fr auto; gap: 10px; align-items: end; }

    /* compatibility info */
    .compat-card {
      background: var(--bg3); border: 1px solid var(--border);
      border-radius: 10px; padding: 1rem; font-size: 0.85rem; margin-bottom: 1rem;
    }
    .compat-card strong { color: var(--crimson); }

    /* toast */
    .toast {
      position: fixed; bottom: 2rem; right: 2rem; z-index: 999;
      background: var(--card); border: 1px solid var(--border);
      border-radius: 10px; padding: 14px 20px;
      font-size: 0.9rem; transform: translateY(100px);
      transition: transform 0.3s; box-shadow: 0 8px 32px rgba(0,0,0,0.4);
    }
    .toast.show { transform: translateY(0); }
    .toast.success { border-color: rgba(34,197,94,0.4); }
    .toast.error { border-color: rgba(192,21,42,0.4); }

    /* loader */
    .spinner { display: inline-block; width: 16px; height: 16px; border: 2px solid rgba(255,255,255,0.2); border-top-color: white; border-radius: 50%; animation: spin 0.6s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }

    .empty-state { text-align: center; padding: 3rem; color: var(--muted); }
    .empty-state .icon { font-size: 3rem; margin-bottom: 1rem; }

    .hidden { display: none !important; }
    .mt1 { margin-top: 1rem; }
    .mt2 { margin-top: 2rem; }

    @media (max-width: 600px) {
      .form-row { grid-template-columns: 1fr; }
      .request-form-row { grid-template-columns: 1fr 1fr; }
      .blood-chart { grid-template-columns: repeat(4, 1fr); }
      .hero h1 { font-size: 2.2rem; }
      .hero-stats { gap: 1.5rem; }
    }
  </style>
</head>
<body>

<!-- NAV -->
<nav>
  <div class="nav-brand" onclick="showPage('home')">
    ü©∏ <span>Donor<span class="drop">Match</span></span>
  </div>
  <div class="nav-actions" id="nav-actions">
    <button class="btn btn-ghost" onclick="showPage('login')">Login</button>
    <button class="btn btn-primary" onclick="showPage('register')">Register</button>
  </div>
</nav>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page active" id="page-home">
  <section class="hero">
    <div class="hero-eyebrow">ü©∏ Real-Time Blood Donor Network</div>
    <h1>Find Blood Donors <em>Near You</em>, Instantly</h1>
    <p>Connect available blood donors with hospitals in real time. Every second matters ‚Äî we help close the gap between need and availability.</p>
    <div class="hero-btns">
      <button class="btn btn-primary btn-lg" onclick="showPage('register')">Become a Donor</button>
      <button class="btn btn-ghost btn-lg" onclick="showPage('login')">Hospital Login</button>
    </div>
    <div class="hero-stats">
      <div class="stat"><div class="stat-num" id="hero-donors">‚Äî</div><div class="stat-label">Registered Donors</div></div>
      <div class="stat"><div class="stat-num" id="hero-available">‚Äî</div><div class="stat-label">Available Now</div></div>
      <div class="stat"><div class="stat-num">8</div><div class="stat-label">Blood Types</div></div>
    </div>
  </section>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LOGIN PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-login">
  <div class="auth-container">
    <div class="auth-card">
      <h2>Welcome back</h2>
      <p>Sign in to your DonorMatch account</p>
      <div id="login-error" class="error-msg"></div>
      <div class="form-group">
        <label>EMAIL ADDRESS</label>
        <input type="email" id="login-email" placeholder="you@example.com" />
      </div>
      <div class="form-group">
        <label>PASSWORD</label>
        <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
      </div>
      <button class="btn btn-primary" style="width:100%;justify-content:center;padding:12px" onclick="handleLogin()" id="login-btn">
        Sign In
      </button>
      <div class="auth-switch">Don't have an account? <a onclick="showPage('register')">Register here</a></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê REGISTER PAGE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-register">
  <div class="auth-container">
    <div class="auth-card">
      <h2>Create account</h2>
      <p>Join the DonorMatch network today</p>
      <div id="register-error" class="error-msg"></div>
      <div id="register-success" class="success-msg"></div>

      <div class="role-tabs">
        <div class="role-tab active" id="tab-donor" onclick="selectRole('donor')">ü©∏ Donor</div>
        <div class="role-tab" id="tab-hospital" onclick="selectRole('hospital')">üè• Hospital</div>
      </div>

      <div class="form-row">
        <div class="form-group"><label>FULL NAME</label><input id="reg-name" placeholder="John Doe" /></div>
        <div class="form-group"><label>EMAIL</label><input type="email" id="reg-email" placeholder="you@example.com" /></div>
      </div>
      <div class="form-row">
        <div class="form-group"><label>PHONE</label><input id="reg-phone" placeholder="+91 98765 43210" /></div>
        <div class="form-group"><label>PASSWORD</label><input type="password" id="reg-password" placeholder="Min 6 characters" /></div>
      </div>

      <!-- Donor fields -->
      <div id="donor-fields">
        <div class="form-row">
          <div class="form-group">
            <label>BLOOD TYPE</label>
            <select id="reg-bloodtype">
              <option value="">Select...</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option>
              <option>O+</option><option>O-</option>
            </select>
          </div>
          <div class="form-group"><label>AGE</label><input type="number" id="reg-age" placeholder="25" min="18" max="65" /></div>
        </div>
      </div>

      <!-- Hospital fields -->
      <div id="hospital-fields" class="hidden">
        <div class="form-group"><label>HOSPITAL ADDRESS</label><input id="reg-address" placeholder="123 Medical Street" /></div>
      </div>

      <div class="form-group">
        <label>CITY</label>
        <input id="reg-city" placeholder="Mumbai" />
      </div>

      <button class="btn btn-outline location-btn" onclick="getLocation()" id="location-btn">
        üìç Use My Current Location (GPS)
      </button>
      <input type="hidden" id="reg-lat" />
      <input type="hidden" id="reg-lng" />
      <div id="location-display" style="font-size:0.8rem;color:var(--green);margin-top:6px;"></div>

      <button class="btn btn-primary mt1" style="width:100%;justify-content:center;padding:12px;margin-top:16px" onclick="handleRegister()" id="reg-btn">
        Create Account
      </button>
      <div class="auth-switch">Already have an account? <a onclick="showPage('login')">Sign in</a></div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DONOR DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-donor">
  <div class="dashboard">
    <div class="dashboard-header">
      <div>
        <h2>Welcome, <span id="donor-name">Donor</span></h2>
        <p>Your blood donation profile & availability</p>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="logout()">Sign Out</button>
    </div>

    <!-- Availability Toggle -->
    <div class="avail-card">
      <div class="avail-status">
        <div class="status-dot" id="avail-dot"></div>
        <div class="avail-text">
          <strong id="avail-status-text">Loading...</strong>
          <span>Toggle to update your real-time availability</span>
        </div>
      </div>
      <button class="btn btn-primary" id="avail-toggle-btn" onclick="toggleAvailability()">
        Toggle Availability
      </button>
    </div>

    <!-- Donor Stats -->
    <div class="stats-grid">
      <div class="stat-card red">
        <div class="stat-label">BLOOD TYPE</div>
        <div class="stat-value" id="d-bloodtype">‚Äî</div>
      </div>
      <div class="stat-card green">
        <div class="stat-label">STATUS</div>
        <div class="stat-value" id="d-status">‚Äî</div>
      </div>
      <div class="stat-card blue">
        <div class="stat-label">CITY</div>
        <div class="stat-value" id="d-city" style="font-size:1.2rem">‚Äî</div>
      </div>
      <div class="stat-card yellow">
        <div class="stat-label">AGE</div>
        <div class="stat-value" id="d-age">‚Äî</div>
      </div>
    </div>

    <!-- Blood Compatibility Info -->
    <div id="donor-compat-section">
      <div class="section-title">üß¨ Blood Compatibility</div>
      <div id="donor-compat-info" class="compat-card">Loading...</div>
    </div>

    <!-- Nearby Available Donors -->
    <div class="mt2">
      <div class="section-title">üó∫Ô∏è Search Donors Nearby</div>
      <div class="filters">
        <select id="search-blood"><option value="">All Blood Types</option><option>A+</option><option>A-</option><option>B+</option><option>B-</option><option>AB+</option><option>AB-</option><option>O+</option><option>O-</option></select>
        <button class="btn btn-outline btn-sm" onclick="searchDonors()">Search</button>
        <button class="btn btn-ghost btn-sm" onclick="searchNearby()">üìç Near Me</button>
      </div>
      <div class="donors-grid" id="donors-grid">
        <div class="empty-state"><div class="icon">üîç</div><p>Click Search to find donors</p></div>
      </div>
    </div>
  </div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOSPITAL DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div class="page" id="page-hospital">
  <div class="dashboard">
    <div class="dashboard-header">
      <div>
        <h2>Hospital Dashboard</h2>
        <p id="hospital-name-sub">Blood request management & donor finder</p>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="logout()">Sign Out</button>
    </div>

    <!-- Stats -->
    <div class="stats-grid">
      <div class="stat-card red"><div class="stat-label">TOTAL DONORS</div><div class="stat-value" id="h-total">‚Äî</div></div>
      <div class="stat-card green"><div class="stat-label">AVAILABLE</div><div class="stat-value" id="h-available">‚Äî</div></div>
      <div class="stat-card yellow"><div class="stat-label">UNAVAILABLE</div><div class="stat-value" id="h-unavail">‚Äî</div></div>
      <div class="stat-card blue"><div class="stat-label">ACTIVE REQUESTS</div><div class="stat-value" id="h-requests">‚Äî</div></div>
    </div>

    <!-- Blood Type Distribution -->
    <div class="section-title">ü©∏ Available Donors by Blood Type</div>
    <div class="blood-chart" id="blood-chart"></div>

    <!-- New Blood Request Form -->
    <div class="request-form-card">
      <h3>‚ûï New Blood Request</h3>
      <div class="request-form-row">
        <div class="form-group">
          <label>BLOOD TYPE</label>
          <select id="req-blood">
            <option value="">Type...</option>
            <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
            <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
          </select>
        </div>
        <div class="form-group">
          <label>UNITS</label>
          <input type="number" id="req-units" placeholder="2" min="1" max="20" />
        </div>
        <div class="form-group">
          <label>URGENCY</label>
          <select id="req-urgency">
            <option value="low">Low</option>
            <option value="medium" selected>Medium</option>
            <option value="high">High</option>
            <option value="critical">Critical</option>
          </select>
        </div>
        <div class="form-group" style="margin-bottom:1.2rem">
          <label>&nbsp;</label>
          <button class="btn btn-primary" onclick="submitRequest()">Send Request</button>
        </div>
      </div>
      <div id="request-donors-result" class="hidden mt1"></div>
    </div>

    <!-- Find Compatible Donors -->
    <div class="section-title mt2">üîç Find Compatible Donors</div>
    <div class="filters">
      <select id="h-search-blood">
        <option value="">All Blood Types</option>
        <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
        <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
      </select>
      <button class="btn btn-outline btn-sm" onclick="hospitalSearchDonors()">Search</button>
      <button class="btn btn-ghost btn-sm" onclick="hospitalSearchNearby()">üìç Near Hospital</button>
    </div>
    <div class="donors-grid" id="h-donors-grid">
      <div class="empty-state"><div class="icon">üè•</div><p>Search for compatible donors</p></div>
    </div>

    <!-- Recent Requests -->
    <div class="mt2">
      <div class="section-title">üìã Recent Blood Requests</div>
      <div class="requests-list" id="requests-list">
        <div class="empty-state"><div class="icon">üìã</div><p>No requests yet</p></div>
      </div>
    </div>
  </div>
</div>

<script>
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CONFIG ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const API = ''; // Same origin - backend serves frontend
  let token = localStorage.getItem('dm_token');
  let currentUser = JSON.parse(localStorage.getItem('dm_user') || 'null');
  let currentRole = 'donor';
  let userLat = null, userLng = null;

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UTILS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  function showPage(name) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page-' + name).classList.add('active');
    window.scrollTo(0, 0);
  }

  function showToast(msg, type = 'success') {
    const t = document.getElementById('toast');
    t.textContent = msg;
    t.className = 'toast show ' + type;
    setTimeout(() => t.className = 'toast', 3000);
  }

  function setLoading(btnId, loading) {
    const btn = document.getElementById(btnId);
    if (!btn) return;
    btn.disabled = loading;
    btn.innerHTML = loading ? '<span class="spinner"></span>' : btn.dataset.label || btn.innerHTML;
  }

  async function api(method, path, body) {
    const opts = {
      method,
      headers: { 'Content-Type': 'application/json' },
    };
    if (token) opts.headers['Authorization'] = 'Bearer ' + token;
    if (body) opts.body = JSON.stringify(body);
    const res = await fetch(API + '/api' + path, opts);
    const data = await res.json();
    if (!res.ok) throw new Error(data.message || 'Request failed');
    return data;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AUTH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  function selectRole(role) {
    currentRole = role;
    document.getElementById('tab-donor').classList.toggle('active', role === 'donor');
    document.getElementById('tab-hospital').classList.toggle('active', role === 'hospital');
    document.getElementById('donor-fields').classList.toggle('hidden', role === 'hospital');
    document.getElementById('hospital-fields').classList.toggle('hidden', role === 'donor');
  }

  function getLocation() {
    const btn = document.getElementById('location-btn');
    btn.textContent = '‚è≥ Getting location...';
    navigator.geolocation.getCurrentPosition(pos => {
      userLat = pos.coords.latitude;
      userLng = pos.coords.longitude;
      document.getElementById('reg-lat').value = userLat;
      document.getElementById('reg-lng').value = userLng;
      document.getElementById('location-display').textContent = `‚úÖ Location captured: ${userLat.toFixed(4)}, ${userLng.toFixed(4)}`;
      btn.textContent = '‚úÖ Location Captured!';
    }, err => {
      btn.textContent = 'üìç Use My Current Location (GPS)';
      showToast('Could not get location: ' + err.message, 'error');
    });
  }

  async function handleLogin() {
    const email = document.getElementById('login-email').value.trim();
    const password = document.getElementById('login-password').value;
    const errEl = document.getElementById('login-error');
    errEl.style.display = 'none';

    if (!email || !password) { errEl.textContent = 'Please fill all fields'; errEl.style.display = 'block'; return; }

    document.getElementById('login-btn').dataset.label = 'Sign In';
    setLoading('login-btn', true);
    try {
      const data = await api('POST', '/auth/login', { email, password });
      token = data.token;
      currentUser = data.user;
      localStorage.setItem('dm_token', token);
      localStorage.setItem('dm_user', JSON.stringify(currentUser));
      showToast('Welcome back, ' + currentUser.name + '!');
      loadDashboard();
    } catch (err) {
      errEl.textContent = err.message;
      errEl.style.display = 'block';
    } finally {
      setLoading('login-btn', false);
      document.getElementById('login-btn').textContent = 'Sign In';
    }
  }

  async function handleRegister() {
    const errEl = document.getElementById('register-error');
    const sucEl = document.getElementById('register-success');
    errEl.style.display = 'none'; sucEl.style.display = 'none';

    const body = {
      name: document.getElementById('reg-name').value.trim(),
      email: document.getElementById('reg-email').value.trim(),
      password: document.getElementById('reg-password').value,
      phone: document.getElementById('reg-phone').value.trim(),
      role: currentRole,
      city: document.getElementById('reg-city').value.trim(),
      lat: document.getElementById('reg-lat').value || '0',
      lng: document.getElementById('reg-lng').value || '0',
    };

    if (currentRole === 'donor') {
      body.bloodType = document.getElementById('reg-bloodtype').value;
      body.age = document.getElementById('reg-age').value;
      if (!body.bloodType || !body.age) { errEl.textContent = 'Please fill blood type and age'; errEl.style.display = 'block'; return; }
    } else {
      body.address = document.getElementById('reg-address').value.trim();
    }

    if (!body.name || !body.email || !body.password || !body.phone) {
      errEl.textContent = 'Please fill all required fields'; errEl.style.display = 'block'; return;
    }

    document.getElementById('reg-btn').dataset.label = 'Create Account';
    setLoading('reg-btn', true);
    try {
      const data = await api('POST', '/auth/register', body);
      token = data.token;
      currentUser = data.user;
      localStorage.setItem('dm_token', token);
      localStorage.setItem('dm_user', JSON.stringify(currentUser));
      showToast('Account created! Welcome to DonorMatch üéâ');
      loadDashboard();
    } catch (err) {
      errEl.textContent = err.message;
      errEl.style.display = 'block';
    } finally {
      setLoading('reg-btn', false);
      document.getElementById('reg-btn').textContent = 'Create Account';
    }
  }

  function logout() {
    localStorage.removeItem('dm_token');
    localStorage.removeItem('dm_user');
    token = null; currentUser = null;
    updateNav();
    showPage('home');
    showToast('Signed out successfully');
  }

  function updateNav() {
    const nav = document.getElementById('nav-actions');
    if (currentUser) {
      const dash = currentUser.role === 'donor' ? 'donor' : 'hospital';
      nav.innerHTML = `
        <span style="font-size:0.85rem;color:var(--muted)">${currentUser.name}</span>
        <button class="btn btn-ghost btn-sm" onclick="showPage('${dash}')">Dashboard</button>
        <button class="btn btn-outline btn-sm" onclick="logout()">Sign Out</button>`;
    } else {
      nav.innerHTML = `
        <button class="btn btn-ghost" onclick="showPage('login')">Login</button>
        <button class="btn btn-primary" onclick="showPage('register')">Register</button>`;
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DASHBOARD LOADER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function loadDashboard() {
    updateNav();
    if (!currentUser) return;
    if (currentUser.role === 'donor') {
      showPage('donor');
      loadDonorDash();
    } else {
      showPage('hospital');
      loadHospitalDash();
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DONOR DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function loadDonorDash() {
    try {
      const { profile } = await api('GET', '/auth/me');
      if (!profile) return;

      document.getElementById('donor-name').textContent = profile.name;
      document.getElementById('d-bloodtype').textContent = profile.bloodType;
      document.getElementById('d-city').textContent = profile.city || '‚Äî';
      document.getElementById('d-age').textContent = profile.age;

      updateAvailDisplay(profile.isAvailable);

      // Load compatibility
      const compat = await api('GET', '/donors/compatibility/' + profile.bloodType);
      document.getElementById('donor-compat-info').innerHTML = `
        <strong>${profile.bloodType}</strong> can donate to: <strong style="color:var(--green)">${compat.canDonateTo.join(', ')}</strong><br/>
        Can receive from: <strong style="color:var(--blue)">${compat.canReceiveFrom.join(', ')}</strong>
      `;
    } catch (err) {
      showToast('Error loading profile', 'error');
    }
  }

  function updateAvailDisplay(isAvail) {
    document.getElementById('d-status').textContent = isAvail ? 'Available' : 'Unavailable';
    document.getElementById('d-status').style.color = isAvail ? 'var(--green)' : 'var(--crimson)';
    document.getElementById('avail-status-text').textContent = isAvail ? 'üü¢ You are Available' : 'üî¥ You are Unavailable';
    const dot = document.getElementById('avail-dot');
    dot.className = 'status-dot ' + (isAvail ? 'green' : 'red');
  }

  async function toggleAvailability() {
    const btn = document.getElementById('avail-toggle-btn');
    btn.disabled = true;
    btn.innerHTML = '<span class="spinner"></span>';
    try {
      const res = await api('PATCH', '/donors/toggle-availability');
      updateAvailDisplay(res.isAvailable);
      showToast(res.message);
    } catch (err) {
      showToast(err.message, 'error');
    } finally {
      btn.disabled = false;
      btn.textContent = 'Toggle Availability';
    }
  }

  async function searchDonors(lat, lng) {
    const blood = document.getElementById('search-blood').value;
    let url = '/donors?available=true';
    if (blood) url += '&bloodType=' + blood;
    if (lat && lng) url += `&lat=${lat}&lng=${lng}&maxDistance=50000`;
    renderDonors('donors-grid', url);
  }

  function searchNearby() {
    navigator.geolocation.getCurrentPosition(pos => {
      searchDonors(pos.coords.latitude, pos.coords.longitude);
    }, () => showToast('Location access denied', 'error'));
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOSPITAL DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function loadHospitalDash() {
    document.getElementById('hospital-name-sub').textContent = currentUser.name;
    try {
      const data = await api('GET', '/hospitals/dashboard');
      document.getElementById('h-total').textContent = data.totalDonors;
      document.getElementById('h-available').textContent = data.availableDonors;
      document.getElementById('h-unavail').textContent = data.unavailableDonors;
      document.getElementById('h-requests').textContent = data.activeRequests;

      // Blood type chart
      const chart = document.getElementById('blood-chart');
      const allTypes = ['A+','A-','B+','B-','AB+','AB-','O+','O-'];
      const statsMap = {};
      data.bloodTypeStats.forEach(s => statsMap[s._id] = s.count);
      chart.innerHTML = allTypes.map(t => `
        <div class="blood-type-item">
          <div class="type">${t}</div>
          <div class="count">${statsMap[t] || 0} donors</div>
        </div>`).join('');

      // Recent requests
      const list = document.getElementById('requests-list');
      if (!data.requests || data.requests.length === 0) {
        list.innerHTML = '<div class="empty-state"><div class="icon">üìã</div><p>No requests yet</p></div>';
      } else {
        list.innerHTML = data.requests.map(r => `
          <div class="request-item">
            <div class="request-info">
              <strong>Blood Type: ${r.bloodType} ‚Äî ${r.units} unit(s)</strong>
              <span>${new Date(r.requestedAt).toLocaleDateString('en-IN', {dateStyle:'medium'})}</span>
            </div>
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <span class="urgency-badge ${r.urgency}">${r.urgency.toUpperCase()}</span>
              ${r.fulfilled ? '<span class="fulfilled-badge">‚úÖ Fulfilled</span>' : `<button class="btn btn-green btn-sm" onclick="fulfillRequest('${r._id}')">Mark Fulfilled</button>`}
            </div>
          </div>`).join('');
      }
    } catch (err) {
      showToast('Error loading dashboard', 'error');
    }
  }

  async function submitRequest() {
    const bloodType = document.getElementById('req-blood').value;
    const units = document.getElementById('req-units').value;
    const urgency = document.getElementById('req-urgency').value;
    if (!bloodType || !units) { showToast('Fill blood type and units', 'error'); return; }

    try {
      const res = await api('POST', '/hospitals/request', { bloodType, units: parseInt(units), urgency });
      showToast('Request submitted!');
      const resultEl = document.getElementById('request-donors-result');
      if (res.compatibleDonors.length > 0) {
        resultEl.innerHTML = `<div style="font-size:0.85rem;color:var(--green);margin-bottom:8px">‚úÖ ${res.compatibleDonors.length} compatible donor(s) found:</div>` +
          res.compatibleDonors.map(d => `<div style="background:var(--bg3);border-radius:8px;padding:8px 12px;margin-bottom:6px;font-size:0.85rem">
            <strong>${d.name}</strong> ‚Äî ${d.bloodType} ‚Äî ${d.city || 'Unknown'} ‚Äî üìû ${d.phone}</div>`).join('');
        resultEl.classList.remove('hidden');
      } else {
        resultEl.innerHTML = `<div style="font-size:0.85rem;color:var(--accent)">‚ö†Ô∏è No available compatible donors found right now.</div>`;
        resultEl.classList.remove('hidden');
      }
      loadHospitalDash();
    } catch (err) {
      showToast(err.message, 'error');
    }
  }

  async function fulfillRequest(reqId) {
    try {
      await api('PATCH', '/hospitals/request/' + reqId + '/fulfill');
      showToast('Marked as fulfilled ‚úÖ');
      loadHospitalDash();
    } catch (err) {
      showToast(err.message, 'error');
    }
  }

  async function hospitalSearchDonors(lat, lng) {
    const blood = document.getElementById('h-search-blood').value;
    let url = '/hospitals/find-donors?';
    if (blood) url += 'bloodType=' + blood;
    if (lat && lng) url += `&lat=${lat}&lng=${lng}&maxDistance=100000`;
    renderDonors('h-donors-grid', url);
  }

  function hospitalSearchNearby() {
    navigator.geolocation.getCurrentPosition(pos => {
      hospitalSearchDonors(pos.coords.latitude, pos.coords.longitude);
    }, () => showToast('Location access denied', 'error'));
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SHARED DONOR RENDERER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function renderDonors(gridId, url) {
    const grid = document.getElementById(gridId);
    grid.innerHTML = '<div style="color:var(--muted);padding:2rem;text-align:center"><span class="spinner"></span> Loading donors...</div>';
    try {
      const donors = await api('GET', url);
      if (!donors.length) {
        grid.innerHTML = '<div class="empty-state"><div class="icon">üòî</div><p>No donors found</p></div>';
        return;
      }
      grid.innerHTML = donors.map(d => `
        <div class="donor-card">
          <div class="donor-card-top">
            <div class="blood-badge">${d.bloodType}</div>
            <span class="avail-badge ${d.isAvailable ? 'available' : 'unavailable'}">${d.isAvailable ? '‚óè Available' : '‚óè Unavailable'}</span>
          </div>
          <div class="donor-name">${d.name}</div>
          <div class="donor-meta">
            <span>üèôÔ∏è ${d.city || d.location?.city || 'Unknown'}</span>
            <span>üë§ Age ${d.age}</span>
          </div>
          ${d.isAvailable ? `<a class="btn btn-primary btn-sm" href="tel:${d.phone}" style="margin-top:10px;justify-content:center;display:flex">üìû ${d.phone}</a>` : ''}
        </div>`).join('');
    } catch (err) {
      grid.innerHTML = '<div class="empty-state"><div class="icon">‚ö†Ô∏è</div><p>' + err.message + '</p></div>';
    }
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê HOME STATS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  async function loadHomeStats() {
    try {
      const donors = await api('GET', '/donors');
      const available = donors.filter(d => d.isAvailable).length;
      document.getElementById('hero-donors').textContent = donors.length;
      document.getElementById('hero-available').textContent = available;
    } catch (e) {}
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê INIT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  (function init() {
    if (token && currentUser) {
      updateNav();
      loadDashboard();
    }
    loadHomeStats();
  })();
</script>
</body>
</html>
